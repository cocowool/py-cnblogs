
<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="referrer" content="origin" />
<title>PHP中的正则表达式及模式匹配 - Cocowool - 博客园</title>
<meta property="og:description" content="整理摘抄了手册中关于PHP模式修正符的内容，真切的体会到手册的好处" />
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=-duj5vpGTntb85GJoM3iRI972XwWcI-j8zmqDzyfu2w1"/>
<link type="text/css" rel="stylesheet" href="/blog/customcss/43046.css?v=jIe%2bqkoe6NGEDBHSKfZFtSP%2bk3Q%3d"/>
<link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/Custom/bundle-Custom-mobile.css?v=D4ZG96to-4HBTPc_nukUGx4UJPJRCpcXUrj8NiiyXiU1"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/cocowool/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/cocowool/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/cocowool/wlwmanifest.xml"/>
<script src="//common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
<script type="text/javascript">var currentBlogApp = 'cocowool', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="/bundles/blog-common.js?v=0t5BJebAFvrpW2OAhYKrwtj8nG5UE2GXuvUfBo9JUgs1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>
<!--PageBeginHtml Block Begin-->
<div id="bgoverlay"></div>
<!--PageBeginHtml Block End-->

<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="https://www.cnblogs.com/cocowool/"><img id="blogLogo" src="/Skins/custom/images/logo.gif" alt="返回主页" /></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="https://www.cnblogs.com/cocowool/">小狼的世界</a></h1>
<h2>不积跬步，无以至千里、不积细流，无以成江海</h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">博客园</a></li>
<li><a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/cocowool/">首页</a></li>
<li></li>
<li><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/Cocowool">联系</a></li>
<li><a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/cocowool/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="https://www.cnblogs.com/cocowool/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>
		<div class="blogStats">
			
			<div id="blog_stats">
<span id="stats_post_count">随笔 - 363&nbsp; </span>
<span id="stats_article_count">文章 - 4&nbsp; </span>
<span id="stats-comment_count">评论 - 449</span>
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class = "post">
		<h1 class = "postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/cocowool/archive/2012/02/04/2337841.html">PHP中的正则表达式及模式匹配</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->
<div style="font-family: Arial; line-height: normal; font-size: medium; ">PHP中对于正则处理文本提供了两种方式，一种是PCRE方式（PCRE库是一个实现了与perl 5在语法和语义上略有差异(详见下文)的正则表达式模式匹配功能的函数集. 当前的实现对应于perl 5.005.）；另一个是POSIX方式。</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">PCRE函数库中的函数使用的模式语法非常类似perl. 表达式必须用分隔符闭合, 比如一个正斜杠(/). 分隔符可以使任意非字母数字, 除反斜杠(\)和空字节之外的非空白ascii字符. 如果分隔符 在表达式中使用, 需要使用反斜线进行转义. 自php 4.0.4开始, 可以使用perl样式的(), {}, []以及&lt;&gt;作为分隔符. 更详细的解释参见模式语法.</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">结束分隔符后面可以紧跟模式修饰符来影响匹配效果. 参见模式修饰符.<br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong style="font-size: 18px; ">PCRE的模式修正符</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>i (PCRE_CASELESS)&nbsp;</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">如果设定此修正符，模式中的字符将同时匹配大小写字母。</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>s（PCRE_DOTALL）</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">如果设定了此修正符，模式中的圆点元字符（.）匹配所有的字符，包括换行符。没有此设定的话，则不包括换行符。这和 Perl 的 /s 修正符是等效的。排除字符类例如 [^a] 总是匹配换行符的，无论是否设定了此修正符。</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>m（PCRE_MULTILINE）</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">默认情况下，PCRE 将目标字符串作为单一的一&#8220;行&#8221;字符所组成的（甚至其中包含有换行符也是如此）。&#8220;行起始&#8221;元字符（^）仅仅匹配字符串的起始，&#8220;行结束&#8221;元字符（$）仅仅匹配字符串的结束，或者最后一个字符是换行符时其前面（除非设定了 D 修正符）。这和 Perl 是一样的。当设定了此修正符，&#8220;行起始&#8221;和&#8220;行结束&#8221;除了匹配整个字符串开头和结束外，还分别匹配其中的换行符的之后和之前。这和 Perl 的 /m 修正符是等效的。如果目标字符串中没有&#8220;\n&#8221;字符或者模式中没有 ^ 或 $，则设定此修正符没有任何效果。</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>x (PCRE_EXTENDED)</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">如果设置了这个修饰符, 模式中的没有经过转义的或不在字符类中的空白数据字符总会被忽略, 并且位于一个未转义的字符类外部的#字符和下一个换行符之间的字符也被忽略. 这个修饰符 等同于perl中的/x修饰符, 使被编译模式中可以包含注释. 注意: 这仅用于数据字符. 空白字符 还是不能在模式的特殊字符序列中出现, 比如序列(?(引入了一个条件子组(译注: 这种语法定义的 特殊字符序列中如果出现空白字符会导致编译错误. 比如( ?(就会导致错误.).</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>e (PREG_REPLACE_EVAL)</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">如果这个修饰符设置了, preg_replace()在进行了对替换字符串的 后向引用替换之后, 将替换后的字符串作为php代码评估之行(eval函数方式), 并使用之行结果 作为实际参与替换的字符串. 单引号, 双引号, 反斜线(\)和NULL字符在 后向引用替换时会被用反斜线转义.</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><font  color="#ff2617">仅preg_replace()使用此修饰符, 其他PCRE函数忽略此修饰符.</font></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>A (PCRE_ANCHORED)</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">如果设置了这个修饰符, 模式被强制为"锚定"模式, 也就是说约束匹配使其仅从 目标字符串的开始位置搜索. 这个效果同样可以使用适当的模式构造出来, 并且 这也是perl种实现这种模式的唯一途径.</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>D (PCRE_DOLLAR_ENDONLY)</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">如果这个修饰符被设置, 模式中的元字符美元符号仅仅匹配目标字符串的末尾. 如果这个修饰符 没有设置, 当字符串以一个换行符结尾时, 美元符号还会匹配该换行符(但不会匹配之前的任何换行符). 如果设置了修饰符m, 这个修饰符被忽略. 在perl中没有与此修饰符等同的修饰符.</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>S</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">当一个模式需要多次使用的时候, 为了得到匹配速度的提升, 值得花费一些时间 对其进行一些额外的分析. 如果设置了这个修饰符, 这个额外的分析就会执行. 当前, 这种对一个模式的分析仅仅适用于非锚定模式的匹配(即没有单独的固定开始字符).</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>U (PCRE_UNGREEDY)</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">这个修饰符逆转了量词的"贪婪"模式. 使量词默认为非贪婪的, 通过量词后紧跟? 的方式可以使其成为贪婪的. 这和perl是不兼容的. 它同样可以使用 模式内修饰符设置 (?U)进行设置, 或者在量词后以问号标记其非贪婪(比如.*?).<font  color="#ff2617">在非贪婪模式, 通常不能匹配超过 pcre.backtrack_limit 的字符.</font></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>X (PCRE_EXTRA)</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">这个修饰符打开了PCRE与perl不兼容的附件功能. 模式中的任意反斜线后就ingen一个 没有特殊含义的字符都会导致一个错误, 以此保留这些字符以保证向后兼容性. 默认 情况下, 在perl中, 反斜线紧跟一个没有特殊含义的字符被认为是该字符的原文. 当前没有其他特性由这个修饰符控制.</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>J (PCRE_INFO_JCHANGED)</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">内部选项设置(?J)修改本地的PCRE_DUPNAMES选项. 允许子组重名. (译注:只能通过内部选项设置, 外部的/J设置会产生错误.)</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><strong>u (PCRE8)</strong></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">此修正符打开一个与perl不兼容的附加功能. 模式字符串被认为是utf-8的. 这个修饰符 从unix版php 4.1.0或更高, win32版php 4.2.3开始可用. php 4.3.5开始检查模式的utf-8合法性. This modifier turns on additional functionality of PCRE that is incompatible with Perl. Pattern strings are treated as UTF-8. This modifier is available from PHP 4.1.0 or greater on Unix and from PHP 4.2.3 on win32. UTF-8 validity of the pattern is checked since PHP 4.3.5.</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; "><br />
</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">参考资料：</div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">1、<a href="http://topic.csdn.net/u/20091231/02/ae285993-01db-4551-bb56-eeca1a407724.html">preg_match_all截取body正则表达式</a></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">2、<a href="http://blog.sina.com.cn/s/blog_5ac88b350100bz2h.html">PHP正则表达式匹配多行及模式匹配</a></div>
<div style="font-family: Arial; line-height: normal; font-size: medium; ">3、<a href="http://docs.php.net/manual/zh/reference.pcre.pattern.modifiers.php">PHP Manual PCRE模式</a></div>
<style type="text/css" isprelink="true">@import url(http://www.cnblogs.com/Load.ashx?type=style&file=SyntaxHighlighter.css);</style><style type="text/css">@import url(/css/cuteeditor.css);</style></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class = "postDesc">posted @ <span id="post-date">2012-02-04 11:42</span> <a href='https://www.cnblogs.com/cocowool/'>Cocowool</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>)  <a href ="https://i.cnblogs.com/EditPosts.aspx?postid=2337841" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(2337841);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=43046,cb_entryId=2337841,cb_blogApp=currentBlogApp,cb_blogUserGuid='6151420b-63cf-dd11-9e4d-001cf0cd104b',cb_entryCreatedDate='2012/2/4 11:42:00';loadViewCount(cb_entryId);var cb_postType=1;</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id='comment_form' class='commentform'>
<a name='commentform'></a>
<div id='divCommentShow'></div>
<div id='comment_nav'><span id='span_refresh_tips'></span><a href='javascript:void(0);' onclick='return RefreshCommentList();' id='lnk_RefreshComments' runat='server' clientidmode='Static'>刷新评论</a><a href='#' onclick='return RefreshPage();'>刷新页面</a><a href='#top'>返回顶部</a></div>
<div id='comment_form_container'></div>
<div class='ad_text_commentbox' id='ad_text_under_commentbox'></div>
<div id='ad_t2'></div>
<div id='opt_under_post'></div>
<div id='cnblogs_c1' class='c_ad_block'></div>
<div id='under_post_news'></div>
<script async='async' src='https://www.googletagservices.com/tag/js/gpt.js'></script>
<script>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
</script>

<script>
  googletag.cmd.push(function() {
    googletag.defineSlot('/1090369/C2', [468, 60], 'div-gpt-ad-1539008685004-0').addService(googletag.pubads());
    googletag.pubads().enableSingleRequest();
    googletag.enableServices();
  });
</script>
<div id='cnblogs_c2' class='c_ad_block'>
    <div id='div-gpt-ad-1539008685004-0' style='height:60px; width:468px;'>
    <script>
    if (new Date() >= new Date(2018, 9, 13)) {
        googletag.cmd.push(function() { googletag.display('div-gpt-ad-1539008685004-0'); });
    }
    </script>
    </div>
</div>
<div id='under_post_kb'></div>
<div id='HistoryToday' class='c_ad_block'></div>
<script type='text/javascript'>
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright &copy;2018 Cocowool
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
<!--PageEndHtml Block Begin-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?433c388afd6e0af1d67cfe808874c659";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!--PageEndHtml Block End-->
</body>
</html>
