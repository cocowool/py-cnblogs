
<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="referrer" content="origin" />
<title>Pandas 快速入门（二） - Cocowool - 博客园</title>
<meta property="og:description" content="本文的例子需要一些特殊设置，具体可以参考 "Pandas快速入门（一）" 数据清理和转换 我们在进行数据处理时，拿到的数据可能不符合我们的要求。有很多种情况，包括部分数据缺失，一些数据的格式不正确，一" />
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=-duj5vpGTntb85GJoM3iRI972XwWcI-j8zmqDzyfu2w1"/>
<link type="text/css" rel="stylesheet" href="/blog/customcss/43046.css?v=jIe%2bqkoe6NGEDBHSKfZFtSP%2bk3Q%3d"/>
<link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/Custom/bundle-Custom-mobile.css?v=D4ZG96to-4HBTPc_nukUGx4UJPJRCpcXUrj8NiiyXiU1"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/cocowool/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/cocowool/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/cocowool/wlwmanifest.xml"/>
<script src="//common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
<script type="text/javascript">var currentBlogApp = 'cocowool', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="/bundles/blog-common.js?v=0t5BJebAFvrpW2OAhYKrwtj8nG5UE2GXuvUfBo9JUgs1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>
<!--PageBeginHtml Block Begin-->
<div id="bgoverlay"></div>
<!--PageBeginHtml Block End-->

<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="https://www.cnblogs.com/cocowool/"><img id="blogLogo" src="/Skins/custom/images/logo.gif" alt="返回主页" /></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="https://www.cnblogs.com/cocowool/">小狼的世界</a></h1>
<h2>不积跬步，无以至千里、不积细流，无以成江海</h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">博客园</a></li>
<li><a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/cocowool/">首页</a></li>
<li></li>
<li><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/Cocowool">联系</a></li>
<li><a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/cocowool/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="https://www.cnblogs.com/cocowool/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>
		<div class="blogStats">
			
			<div id="blog_stats">
<span id="stats_post_count">随笔 - 363&nbsp; </span>
<span id="stats_article_count">文章 - 4&nbsp; </span>
<span id="stats-comment_count">评论 - 449</span>
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class = "post">
		<h1 class = "postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/cocowool/p/8417865.html">Pandas 快速入门（二）</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown"><p>本文的例子需要一些特殊设置，具体可以参考 <a href="http://www.cnblogs.com/cocowool/p/8316595.html">Pandas快速入门（一）</a></p>
<h3 id="数据清理和转换">数据清理和转换</h3>
<p>我们在进行数据处理时，拿到的数据可能不符合我们的要求。有很多种情况，包括部分数据缺失，一些数据的格式不正确，一些数据的标注问题等等。对于这些数据，我们在开始分析之前必须进行必要的整理、清理。</p>
<p>清理和转换的过程中用到最对的包括判断是否存在空值(obj.isnull)，删除空值(dropna)、填充空值(fillna)、大小写转换、文字替换(replace)等等。我这里挑几个典型的场景来学习一下。</p>
<h4 id="判断是否存在有空值的行并删除行">判断是否存在有空值的行，并删除行</h4>
<p>先构建一个具有空值的DataFrame对象。</p>
<pre class="sh"><code>In [17]: stat = DataFrame.from_dict({&quot;Beijing&quot;:{&quot;People&quot;:3100,&quot;Area&quot;:540,&quot;GDP&quot;:3000},&quot;Guangzhou&quot;:{&quot;People&quot;:np.nan,&quot;Area&quot;:370,&quot;GDP&quot;:2500},&quot;Shanghai&quot;:
    ...: {&quot;People&quot;:2800,&quot;Area&quot;:500,&quot;GDP&quot;:3100},&quot;Shenzhen&quot;:{&quot;People&quot;:1800,&quot;Area&quot;:np.nan,&quot;GDP&quot;:2100}},orient=&#39;index&#39;)

In [18]: stat
Out[18]: 
           People   Area   GDP
Beijing    3100.0  540.0  3000
Guangzhou     NaN  370.0  2500
Shanghai   2800.0  500.0  3100
Shenzhen   1800.0    NaN  2100

In [20]: stat.isnull()
Out[20]: 
           People   Area    GDP
Beijing     False  False  False
Guangzhou    True  False  False
Shanghai    False  False  False
Shenzhen    False   True  False

In [24]: stat = stat.dropna()

In [25]: stat
Out[25]: 
          People   Area   GDP
Beijing   3100.0  540.0  3000
Shanghai  2800.0  500.0  3100</code></pre>
<p>这样就把包含空值的行全部删除了。</p>
<h4 id="对标签数据进行规范化转换对数据进行替换">对标签数据进行规范化转换，对数据进行替换</h4>
<p>本例的目的是，数据中存在一些语义标签表达不规范，按照规范的方式进行统一修改并进行替换。例如，根据Gender规范人员的称呼，对职业进行规范。</p>
<pre class="sh"><code>In [26]: people = DataFrame.from_dict(
    ...:     {&quot;Xiao Zhang&quot;:{&quot;Gender&quot;:&quot;Male&quot;,&quot;Age&quot;:24,&quot;Occupation&quot;:&quot;小学老师&quot;},
    ...:     &quot;xiao Wang&quot;:{&quot;Gender&quot;:&quot;Female&quot;,&quot;Age&quot;:25,&quot;Occupation&quot;:&quot;大学老师&quot;},
    ...:     &quot;Xiao Wei&quot;:{&quot;Gender&quot;:&quot;Male&quot;,&quot;Age&quot;:23,&quot;Occupation&quot;:&quot;百度公司&quot;},
    ...:     &quot;Lao Shi&quot;:{&quot;Gender&quot;:&quot;Female&quot;,&quot;Age&quot;:55,&quot;Occupation&quot;:&quot;阿里巴巴&quot;}},
    ...:     orient=&#39;index&#39;)
    ...:     

In [27]: people
Out[27]: 
            Gender  Age Occupation
Lao Shi     Female   55       阿里巴巴
Xiao Wei      Male   23       百度公司
Xiao Zhang    Male   24       小学老师
xiao Wang   Female   25       大学老师</code></pre>
<p>第一个需求，就是把职业一栏，规范为“教师”、“公司职员”。</p>
<pre class="sh"><code>In [28]: map = {
    ...:     &quot;小学老师&quot; : &quot;教师&quot;,
    ...:     &quot;大学老师&quot; : &quot;教师&quot;,
    ...:     &quot;百度公司&quot; : &quot;公司职员&quot;,
    ...:     &quot;阿里巴巴&quot; : &quot;公司职员&quot;
    ...: }

In [29]: map
Out[29]: {&#39;大学老师&#39;: &#39;教师&#39;, &#39;小学老师&#39;: &#39;教师&#39;, &#39;百度公司&#39;: &#39;公司职员&#39;, &#39;阿里巴巴&#39;: &#39;公司职员&#39;}

In [30]: people.replace(map)
Out[30]: 
            Gender  Age Occupation
Lao Shi     Female   55       公司职员
Xiao Wei      Male   23       公司职员
Xiao Zhang    Male   24         教师
xiao Wang   Female   25         教师
</code></pre>
<p>另一个需求，根据Gender增加一列称谓。这里就不考虑已婚未婚了。</p>
<pre class="sh"><code>In [34]: def NormalizeName(gender):
    ...:     if( gender == &quot;Male&quot;):
    ...:         return &quot;Mr &quot;
    ...:     elif( gender == &quot;Female&quot; ):
    ...:         return &quot;Mrs &quot;
    ...:  

In [40]: people[&#39;title&#39;] =  people[&#39;Gender&#39;].map(NormalizeName)
In [43]: people
Out[43]: 
            Gender  Age Occupation title
Lao Shi     Female   55       公司职员  Mrs 
Xiao Wei      Male   23       公司职员   Mr 
Xiao Zhang    Male   24         教师   Mr 
xiao Wang   Female   25         教师  Mrs </code></pre>
<blockquote>
<p>对于数据量大的情况，有时候不能够在分析之前就发现数据中存在的问题，往往是分析进行到一半，突然发现有的数据格式或者质量有问题，对于这种情况，不知道大家有没有好的处理办法，让我们提前发现数据问题？</p>
</blockquote>
<h3 id="时间序列">时间序列</h3>
<h4 id="日期和时间数据类型">日期和时间数据类型</h4>
<p>处理时间数据，经常用到Python中的 datetime 模块，该模块中的主要数据类型有。</p>
<table>
<thead>
<tr class="header">
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>date</td>
<td>以公历形式存储日历日期（年、月、日）</td>
</tr>
<tr class="even">
<td>time</td>
<td>将时间存储为时、分、秒、毫秒</td>
</tr>
<tr class="odd">
<td>datetime</td>
<td>存储日期和时间</td>
</tr>
<tr class="even">
<td>timedelta</td>
<td>表示两个datetime值之间的差（日、秒、毫秒）</td>
</tr>
</tbody>
</table>
<p>与时间序列相关的还有很多功能，包括时区转换。如果是从文件读入的数据，可以使用 <code>parse_dates</code>参数来对日期进行解析。</p>
<p>对于日期型的索引，可以根据日期、月份、年份、日期范围来方便的选择数据。</p>
<pre class="sh"><code>In [131]: jgd[&#39;2017-03&#39;:&#39;2017-04&#39;]
Out[131]: 
                摘要   证券名称   合同编号   成交数量                成交均价     成交金额   手续费  \
成交日期                                                                         
2017-03-01    申购配号   拉芳配号  13932      1                 0.0      0.0   0.0   
2017-03-01    申购配号   康隆配号  13933      1                 0.0      0.0   0.0   
</code></pre>
<p>使用 to_period 和 asfreq 方法，可以方便的将日期转换成按月、按季度、按工作日显示的索引，方便进行后续的统计汇总。我</p>
<h3 id="画图">画图</h3>
<p>DataFrame对象自带一个 plot 方法，可以进行方便的绘图。</p>
<pre class="sh"><code>In [143]: jgd[&#39;成交金额&#39;].resample(&#39;M&#39;).sum()
Out[143]: 
成交日期
2017-01-31      12693.80
2017-02-28      12863.00
2017-03-31     150605.00
2017-04-30     546912.00
2017-05-31     199024.57
2017-06-30     381675.01
2017-07-31     772297.30
2017-08-31    1176152.20
2017-09-30    1328378.00
2017-10-31    1183852.00
2017-11-30    1151724.65
2017-12-31      36120.00
Freq: M, Name: 成交金额, dtype: float64

n [145]: jgd[&#39;成交金额&#39;].resample(&#39;M&#39;).sum().plot()
Out[145]: &lt;matplotlib.axes._subplots.AxesSubplot at 0x10cc78080&gt;</code></pre>
<p>如下图：</p>
<p><img src="https://images2017.cnblogs.com/blog/39469/201802/39469-20180206095943810-555327950.png" /></p>
<h3 id="分组统计">分组统计</h3>
<p>对于分组统计，通常的步骤是“分割、应用（统计函数）、合并”。</p>
<p>Groupby 是Pandas中最常用的分组函数，返回一个 DataFrameGroupBy 对象，该对象实际并不包含数据内容，记录了中间数据，当我们对分组数据进行数学运算时，pandas 再根据对象内的信息对 DataFrame 进行快速分块运算并返回结果。</p>
<p>1、根据某个字段分组并求和</p>
<pre class="sh"><code>In [171]: jgd.columns
Out[171]: 
Index([&#39;摘要&#39;, &#39;证券名称&#39;, &#39;合同编号&#39;, &#39;成交数量&#39;, &#39;成交均价&#39;, &#39;成交金额&#39;, &#39;手续费&#39;, &#39;印花税&#39;, &#39;其他杂费&#39;,
       &#39;发生金额&#39;, &#39;股东帐户&#39;, &#39;备注&#39;, &#39;操作&#39;, &#39;证券代码&#39;, &#39;结算汇率&#39;, &#39;Unnamed: 16&#39;],
      dtype=&#39;object&#39;)

In [172]: jgd_g1 = jgd.groupby([&#39;证券名称&#39;,&#39;摘要&#39;])

In [173]: jgd_g1.sum()
Out[173]: 
                成交数量        成交金额
证券名称  摘要                        
50ETF 证券买入       500     1228.00
      证券卖出     -1300     3190.20</code></pre>
<h3 id="透视表-pivot_table">透视表 pivot_table</h3>
<p>pivot_table 函数提供了一个生成 Excel 样式透视表的方法。调用格式<code>pd.pivot_table(data,values,index,columns,aggfunc)</code>。</p>
<ul>
<li>data : 需要处理的 DataFrame 对象</li>
<li>values : 一个或一组需要分组的列名</li>
<li>index : a column, Grouper, array which has the same length as data, or list of them. Keys to group by on the pivot table index. If an array is passed, it is being used as the same manner as column values.</li>
<li>columns : a column, Grouper, array which has the same length as data, or list of them. Keys to group by on the pivot table column. If an array is passed, it is being used as the same manner as column values.</li>
<li>aggfunc : function to use for aggregation, defaulting to numpy.mean.</li>
</ul>
<h3 id="导入和导出数据">导入和导出数据</h3>
<h4 id="从csv导入数据">从CSV导入数据</h4>
<pre class="sh"><code>In [72]: jg = pd.read_csv(&#39;jg-2017-12-utf8.csv&#39;,parse_dates=True,index_col=0)

In [73]: jg
Out[73]: 
                摘要   证券名称   合同编号   成交数量     成交均价   成交金额   手续费   印花税  其他杂费  \
成交日期                                                                        
2017-12-01  基金资金拨出   天天发１      0      0    1.000      0  0.00  0.00  0.00   
2017-12-01    证券卖出   民丰特纸   8471  -1000    7.120   7120  5.00  7.12  0.14 </code></pre>
<h4 id="将数据写入到csv中">将数据写入到CSV中</h4>
<pre class="sh"><code>In [82]: del jg[&#39;结算汇率&#39;]
In [84]: jg.to_csv(&#39;test.csv&#39;)
In [90]: cat test.csv
成交日期,摘要,证券名称,合同编号,成交数量,成交均价,成交金额,手续费,印花税,其他杂费,发生金额,股东帐户,备注,操作,证券代码
2017-12-01,基金资金拨出,天天发１,0,0,1.0,0,0.0,0.0,0.0,-36118.59,99F6983257,122.0,其他,940018</code></pre>
<h3 id="参考资料">参考资料</h3>
<p>1、利用Pandas进行数据分析<br />
2、<a href="https://www.cnblogs.com/chaosimple/p/4153083.html">十分钟搞定pandas</a><br />
3、<a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.from_dict.html#pandas.DataFrame.from_dict">Pandas Documentation</a><br />
4、<a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.replace.html#pandas.DataFrame.replace">DataFrame Replace</a><br />
5、<a href="http://www.cnblogs.com/lemonbit/p/6896499.html"></a></p>
</div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class = "postDesc">posted @ <span id="post-date">2018-02-05 15:39</span> <a href='https://www.cnblogs.com/cocowool/'>Cocowool</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>)  <a href ="https://i.cnblogs.com/EditPosts.aspx?postid=8417865" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(8417865);return false;">收藏</a></div>
	</div>
	<script src="//common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script><script>markdown_highlight();</script><script type="text/javascript">var allowComments=true,cb_blogId=43046,cb_entryId=8417865,cb_blogApp=currentBlogApp,cb_blogUserGuid='6151420b-63cf-dd11-9e4d-001cf0cd104b',cb_entryCreatedDate='2018/2/5 15:39:00';loadViewCount(cb_entryId);var cb_postType=1;</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id='comment_form' class='commentform'>
<a name='commentform'></a>
<div id='divCommentShow'></div>
<div id='comment_nav'><span id='span_refresh_tips'></span><a href='javascript:void(0);' onclick='return RefreshCommentList();' id='lnk_RefreshComments' runat='server' clientidmode='Static'>刷新评论</a><a href='#' onclick='return RefreshPage();'>刷新页面</a><a href='#top'>返回顶部</a></div>
<div id='comment_form_container'></div>
<div class='ad_text_commentbox' id='ad_text_under_commentbox'></div>
<div id='ad_t2'></div>
<div id='opt_under_post'></div>
<div id='cnblogs_c1' class='c_ad_block'></div>
<div id='under_post_news'></div>
<script async='async' src='https://www.googletagservices.com/tag/js/gpt.js'></script>
<script>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
</script>

<script>
  googletag.cmd.push(function() {
    googletag.defineSlot('/1090369/C2', [468, 60], 'div-gpt-ad-1539008685004-0').addService(googletag.pubads());
    googletag.pubads().enableSingleRequest();
    googletag.enableServices();
  });
</script>
<div id='cnblogs_c2' class='c_ad_block'>
    <div id='div-gpt-ad-1539008685004-0' style='height:60px; width:468px;'>
    <script>
    if (new Date() >= new Date(2018, 9, 13)) {
        googletag.cmd.push(function() { googletag.display('div-gpt-ad-1539008685004-0'); });
    }
    </script>
    </div>
</div>
<div id='under_post_kb'></div>
<div id='HistoryToday' class='c_ad_block'></div>
<script type='text/javascript'>
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright &copy;2018 Cocowool
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
<!--PageEndHtml Block Begin-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?433c388afd6e0af1d67cfe808874c659";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!--PageEndHtml Block End-->
</body>
</html>
